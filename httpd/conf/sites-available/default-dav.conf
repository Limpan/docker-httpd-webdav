<VirtualHost *:80>
  ServerName dav.njudung.etnolit.se
  DocumentRoot /var/lib/dav/data

  DirectoryIndex disabled

  CustomLog /proc/self/fd/1 combined
  ErrorLog /proc/self/fd/2

  <Directory /var/lib/dav/data>
    Dav On
    Options All

    AuthType Basic
    AuthName "WebDAV"
    AuthUserFile /user.passwd

    <RequireAll>
      Require valid-user

      <RequireAny>
        Require expr "%{REQUEST_URI} == '/'"
        Require expr "%{REQUEST_URI} =~ m#^/([^/]+)# && %{REMOTE_USER} == $1"
      </RequireAny>
    </RequireAll>
  </Directory>

  RequestHeader edit Destination ^https http early
</VirtualHost>
